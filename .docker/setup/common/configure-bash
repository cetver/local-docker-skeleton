#!/usr/bin/env bash
set -eo pipefail

base_dir=$(dirname -- "$(realpath -- "$0")")
# shellcheck source=ansi-format
source "${base_dir}/ansi-format"


ansi_format "$0" FG_YELLOW

skeleton_dir="/etc/skel"
home_dir=$(eval echo ~"$USER")

ansi_format "Copy skeleton files" FG_GREEN
fdfind --hidden . "$skeleton_dir" --exec cp --verbose --force {} "$home_dir"

bashrc_file="${home_dir}/.bashrc"

force_color_prompt="force_color_prompt=yes"
sed --in-place --regexp-extended "s@#${force_color_prompt}@${force_color_prompt}@" "$bashrc_file"
ansi_format "Uncomment the '${force_color_prompt}' in the '${bashrc_file}' file" FG_GREEN

locale_file="/etc/default/locale"
echo "
##
# Export locale vars (generated by ${0})
##

if [ -f ${locale_file} ]; then
    set -a
    . ${locale_file}
    set +a
fi
" >> "$bashrc_file"
ansi_format "Export variables from the '${locale_file}' in the '${bashrc_file}' file" FG_GREEN

bash_aliases_file="${home_dir}/.bash_aliases"
echo "
##
# Generated by ${0}
##

alias ll='ls -l --color=auto'
alias la='ls -lA --color=auto'
alias l='ls -CF --color=auto'
" > "$bash_aliases_file"
ansi_format "The '${bash_aliases_file}' file has been created" FG_GREEN
